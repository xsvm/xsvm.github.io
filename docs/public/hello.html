<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>位运算揭秘 | Bitwise Wonders</title>
    <script src="https://cdn.tailwindcss.com/3.4.3"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/framer-motion/11.1.9/motion.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" integrity="sha384-wcPFcUsqnQDGLznRgLzKjpRpfByARNTTTTpv8QTEhJFs7LTCXXTUDRwYCFjOkRwl" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" integrity="sha384-hIoBPJpTUs74ddyc4RaZuUymmvWnnaQlZFAND+YID5OHAGMWcWCKBSkhGMKFquzh" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" integrity="sha384-43gθο2t20VSAdQZtRjIw7GC4YRccBs9FUXDOkWuiGfizFileSystemPathddMfnKDhX3fSUHvx" crossorigin="anonymous"></script>
    <style>
        body {
            background-color: #000000;
            color: #FFFFFF;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            overflow-x: hidden;
        }
        .bento-grid {
            display: grid;
            gap: 1.5rem; /* 24px */
            padding: 1.5rem; /* Updated from 2rem to 1.5rem for slightly tighter feel */
            max-width: 1300px; /* Increased max-width slightly */
            margin: 0 auto;
        }
        .bento-item {
            background-color: #0A0A0A; /* Darker than #111 for more subtlety */
            border-radius: 1.25rem; /* 20px, slightly more rounded */
            padding: 1.75rem; /* 28px, increased padding */
            overflow: hidden;
            position: relative;
            border: 1px solid #1A1A1A; /* Darker subtle border */
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
        }
        .bento-item:hover {
            transform: translateY(-5px) scale(1.01); /* Subtle hover effect */
            box-shadow: 0 10px 30px rgba(227, 25, 55, 0.15); /* Tesla red glow on hover */
        }
        .highlight {
            color: #E31937; /* Tesla Red */
        }
        .text-tesla-red { /* Renamed from highlight for clarity */
            color: #E31937;
        }
        .bg-tesla-red { /* Renamed from highlight-bg */
            background-color: #E31937;
        }
        .border-tesla-red { /* Renamed from highlight-border */
            border-color: #E31937;
        }

        .font-chinese-title {
            font-size: 2.75rem; /* 44px, slightly increased */
            font-weight: 700; /* Bold */
            line-height: 1.25; /* Adjusted line height */
            letter-spacing: 0.02em; /* Slight letter spacing for Chinese */
        }
        .font-english-accent {
            font-size: 0.9rem; /* 14.4px */
            color: #999999; /* Lighter gray for better readability */
            text-transform: uppercase;
            letter-spacing: 0.075em; /* Increased letter spacing */
        }
        .font-code {
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            background-color: #181818; /* Darker code background */
            padding: 0.3rem 0.6rem; /* Adjusted padding */
            border-radius: 0.375rem; /* 6px */
            font-size: 0.9rem; /* Consistent code font size */
            border: 1px solid #282828;
        }

        /* Specific grid item spans */
        .grid-col-span-1 { grid-column: span 1; }
        .grid-col-span-2 { grid-column: span 2; }
        .grid-col-span-3 { grid-column: span 3; }
        @media (min-width: 768px) { /* md */
            .md\:grid-col-span-1 { grid-column: span 1; }
            .md\:grid-col-span-2 { grid-column: span 2; }
            .md\:grid-col-span-3 { grid-column: span 3; }
        }
         @media (min-width: 1024px) { /* lg */
            .lg\:grid-col-span-1 { grid-column: span 1; }
            .lg\:grid-col-span-2 { grid-column: span 2; }
            .lg\:grid-col-span-3 { grid-column: span 3; }
        }

        .large-digit-overlay { /* Renamed and restyled for better effect */
            font-size: 7rem; /* 112px, larger */
            font-weight: 800; /* Extra bold */
            line-height: 1;
            position: absolute;
            opacity: 0.05; /* More subtle opacity */
            right: 1.5rem;
            bottom: 0.5rem; /* Adjusted position */
            color: #E31937;
            z-index: 0;
            user-select: none;
            pointer-events: none; /* So it doesn't interfere with text selection */
        }

        .line-art-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 60px; /* Ensure space for SVGs */
        }
        .line-art-svg {
            stroke: #E31937;
            stroke-width: 1.5; /* Thinner stroke for elegance */
            fill: none;
            opacity: 0.6; /* Slightly reduced opacity */
        }
        .highlight-gradient-bg { /* Renamed for clarity */
            background: linear-gradient(45deg, rgba(227, 25, 55, 0.15), rgba(227, 25, 55, 0.05)); /* More subtle gradient */
        }
        .decorative-glow { /* General purpose glow */
             box-shadow: 0 0 25px 8px rgba(227, 25, 55, 0.1);
        }
        .katex-display { /* Ensure display math is also white by default on black bg */
            color: #FFFFFF;
        }
        .katex {
            font-size: 1.1em; /* Slightly larger math font */
            color: #E0E0E0; /* Light gray for math, can be overridden */
        }
        .font-code .katex { /* If KaTeX is inside font-code, make it match code style a bit */
             color: #E31937; /* Tesla red for math in code blocks */
        }
        .bento-item p, .bento-item li {
            line-height: 1.65; /* Improved line height for readability */
            color: #CCCCCC; /* Lighter text color */
        }
        .bento-item h3 .font-code { /* Make code symbols in titles more prominent */
            font-size: 1.1em;
            padding: 0.2em 0.4em;
            vertical-align: middle;
        }

    </style>
</head>
<body class="antialiased">
    <div id="app" class="py-16">
        <header class="text-center mb-20 px-6">
            <motion.h1 class="font-chinese-title text-5xl md:text-7xl mb-5"
                :initial="{ opacity: 0, y: -60 }"
                :animate="{ opacity: 1, y: 0 }"
                :transition="{ duration: 0.9, ease: 'circOut' }"
            >
                位运算<span class="highlight">探索</span>
            </motion.h1>
            <motion.p class="font-english-accent text-xl md:text-2xl tracking-wider"
                :initial="{ opacity: 0, y: -40 }"
                :animate="{ opacity: 1, y: 0 }"
                :transition="{ duration: 0.9, delay: 0.2, ease: 'circOut' }"
            >
                Exploring the Depths of Bitwise Operations
            </motion.p>
        </header>

        <div class="bento-grid">
            <motion.div class="bento-item md:grid-col-span-2 lg:grid-col-span-3 p-10 flex flex-col justify-center items-center text-center decorative-glow"
                :initial="{ opacity: 0, scale: 0.9 }"
                :while-in-view="{ opacity: 1, scale: 1 }"
                :viewport="{ once: true, amount: 0.3 }"
                :transition="{ duration: 0.7, ease: 'easeOut' }"
            >
                <i class="fas fa-atom text-tesla-red text-7xl mb-8"></i>
                <h2 class="font-chinese-title text-4xl mb-4">二进制<span class="highlight">原力</span></h2>
                <p class="font-english-accent text-lg mb-6">THE BINARY FORCE</p>
                <p class="text-lg md:text-xl text-gray-300 max-w-3xl">
                    计算机的语言是二进制。位运算，作为直接与这些0和1对话的艺术，赋予代码<span class="highlight font-bold">极致速度</span>与<span class="highlight font-bold">精妙控制</span>。一同深入探索，释放这股潜藏的强大原力。
                    <br>
                    <span class="font-english-accent mt-3 block">Bitwise operations are the art of speaking directly to zeros and ones, granting code ultimate speed and fine-grained control.</span>
                </p>
            </motion.div>

            <motion.div class="bento-item md:grid-col-span-1 lg:grid-col-span-1 flex flex-col justify-center items-center text-center"
                :initial="{ opacity: 0, y: 60 }"
                :while-in-view="{ opacity: 1, y: 0 }"
                :viewport="{ once: true, amount: 0.3 }"
                :transition="{ duration: 0.6, delay: 0.1, ease: 'easeOut' }"
            >
                <i class="fas fa-chess-board text-tesla-red text-6xl mb-5"></i>
                <h2 class="font-chinese-title text-3xl">基础<span class="highlight">棋子</span></h2>
                <p class="font-english-accent">FUNDAMENTAL MOVES</p>
            </motion.div>

            <motion.div class="bento-item"
                :initial="{ opacity: 0, y: 60 }"
                :while-in-view="{ opacity: 1, y: 0 }"
                :viewport="{ once: true, amount: 0.3 }"
                :transition="{ duration: 0.6, delay: 0.2, ease: 'easeOut' }"
            >
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-chinese-title text-2xl">按位<span class="highlight">与</span></h3>
                    <span class="font-code text-tesla-red">&</span>
                </div>
                <p class="font-english-accent mb-3">LOGICAL AND</p>
                <p class="text-sm mb-4">两位皆1则为1。用于<span class="highlight">掩码</span>操作，提取或<span class="highlight">清零</span>特定位。</p>
                <p class="font-code text-base">0101 & 0011 <span class="text-tesla-red mx-2 transform scale-150 inline-block">→</span> 0001</p>
                <div class="large-digit-overlay">&</div>
            </motion.div>

            <motion.div class="bento-item"
                :initial="{ opacity: 0, y: 60 }"
                :while-in-view="{ opacity: 1, y: 0 }"
                :viewport="{ once: true, amount: 0.3 }"
                :transition="{ duration: 0.6, delay: 0.3, ease: 'easeOut' }"
            >
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-chinese-title text-2xl">按位<span class="highlight">或</span></h3>
                    <span class="font-code text-tesla-red">|</span>
                </div>
                <p class="font-english-accent mb-3">LOGICAL OR</p>
                <p class="text-sm mb-4">任一为1则为1。用于<span class="highlight">设置</span>特定位为1。</p>
                <p class="font-code text-base">0101 | 0011 <span class="text-tesla-red mx-2 transform scale-150 inline-block">→</span> 0111</p>
                <div class="large-digit-overlay">|</div>
            </motion.div>

            <motion.div class="bento-item"
                :initial="{ opacity: 0, y: 60 }"
                :while-in-view="{ opacity: 1, y: 0 }"
                :viewport="{ once: true, amount: 0.3 }"
                :transition="{ duration: 0.6, delay: 0.4, ease: 'easeOut' }"
            >
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-chinese-title text-2xl">按位<span class="highlight">异或</span></h3>
                    <span class="font-code text-tesla-red">^</span>
                </div>
                <p class="font-english-accent mb-3">EXCLUSIVE OR</p>
                <p class="text-sm mb-3">两位相异为1，相同为0。关键属性: <span class="font-code text-tesla-red">a ^ b ^ b = a</span>。</p>
                <p class="text-sm mb-4">用于<span class="highlight">翻转</span>位，无临时变量交换，加密。</p>
                <p class="font-code text-base">0101 ^ 0011 <span class="text-tesla-red mx-2 transform scale-150 inline-block">→</span> 0110</p>
                <div class="large-digit-overlay">^</div>
            </motion.div>

            <motion.div class="bento-item md:grid-col-span-1"
                :initial="{ opacity: 0, y: 60 }"
                :while-in-view="{ opacity: 1, y: 0 }"
                :viewport="{ once: true, amount: 0.3 }"
                :transition="{ duration: 0.6, delay: 0.2, ease: 'easeOut' }"
            >
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-chinese-title text-2xl">按位<span class="highlight">取反</span></h3>
                    <span class="font-code text-tesla-red">~</span>
                </div>
                <p class="font-english-accent mb-3">LOGICAL NOT (COMPLEMENT)</p>
                <p class="text-sm mb-4">逐位反转 (0↔1)。作用于<span class="highlight">补码</span>，符号位亦反。</p>
                <p class="font-code text-base">~0101 <span class="text-gray-500">(4-bit)</span> <span class="text-tesla-red mx-2 transform scale-150 inline-block">→</span> 1010</p>
                <div class="large-digit-overlay">~</div>
            </motion.div>

            <motion.div class="bento-item md:grid-col-span-2 highlight-gradient-bg"
                :initial="{ opacity: 0, y: 60 }"
                :while-in-view="{ opacity: 1, y: 0 }"
                :viewport="{ once: true, amount: 0.3 }"
                :transition="{ duration: 0.6, delay: 0.3, ease: 'easeOut' }"
            >
                <i class="fas fa-rocket text-tesla-red text-4xl absolute top-6 right-6 opacity-30 transform rotate-[-45deg]"></i>
                <h2 class="font-chinese-title text-3xl mb-4">移位<span class="highlight">魔法</span></h2>
                <p class="font-english-accent mb-5">THE MAGIC OF SHIFTING</p>
                <div class="space-y-4">
                    <div>
                        <h4 class="font-semibold text-xl text-gray-100">左移 <span class="font-code text-tesla-red">&lt;&lt;</span></h4>
                        <p class="text-sm text-gray-300">`num << i` : 位左移 `i` 格，右补0。效果：乘以 $2^i$ 。</p>
                        <p class="font-code text-base mt-1">00101 (5) &lt;&lt; 2 <span class="text-tesla-red mx-2 transform scale-150 inline-block">→</span> 10100 (20)</p>
                    </div>
                    <div>
                        <h4 class="font-semibold text-xl text-gray-100">右移 <span class="font-code text-tesla-red">&gt;&gt;</span></h4>
                        <p class="text-sm text-gray-300">`num >> i` : 位右移 `i` 格。无符号数左补0；有符号数补<span class="highlight">符号位</span> (算术右移)。效果：除以 $2^i$ (向下取整)。</p>
                         <p class="font-code text-base mt-1">01010 (10) >> 1 <span class="text-tesla-red mx-2 transform scale-150 inline-block">→</span> 00101 (5)</p>
                    </div>
                </div>
            </motion.div>

            <motion.div class="bento-item md:grid-col-span-3 lg:grid-col-span-1 flex flex-col justify-center items-center text-center decorative-glow"
                :initial="{ opacity: 0, y: 60 }"
                :while-in-view="{ opacity: 1, y: 0 }"
                :viewport="{ once: true, amount: 0.3 }"
                :transition="{ duration: 0.6, delay: 0.1, ease: 'easeOut' }"
            >
                <i class="fas fa-wrench text-tesla-red text-6xl mb-5"></i>
                <h2 class="font-chinese-title text-3xl">实用<span class="highlight">技巧</span></h2>
                <p class="font-english-accent">POWERFUL TECHNIQUES</p>
            </motion.div>

            <motion.div class="bento-item md:grid-col-span-2"
                :initial="{ opacity: 0, y: 60 }"
                :while-in-view="{ opacity: 1, y: 0 }"
                :viewport="{ once: true, amount: 0.3 }"
                :transition="{ duration: 0.6, delay: 0.2, ease: 'easeOut' }"
            >
                <h3 class="font-chinese-title text-2xl mb-3">Lowbit <span class="highlight">侦测</span></h3>
                <p class="font-english-accent mb-4">DETECTING THE LOWEST SET BIT</p>
                <p class="text-sm mb-3">
                    获取二进制中<span class="highlight">最低位1</span>所代表的值 (e.g., for `...1000`, lowbit is `1000`).
                    <br>公式: <span class="font-code text-tesla-red">x & -x</span> (基于补码 <span class="font-code text-tesla-red">x & (~x + 1)</span>).
                </p>
                <p class="font-code text-base">x = 01011000 (88)</p>
                <p class="font-code text-base mt-1">lowbit(x) <span class="text-tesla-red mx-2 transform scale-150 inline-block">→</span> 00001000 (8)</p>
                <div class="line-art-container mt-5">
                    <svg viewBox="0 0 220 50" class="line-art-svg w-full h-auto max-h-16">
                        <text x="10" y="20" font-size="12" fill="#ccc">x = 0101</text>
                        <text x="70" y="20" font-size="12" fill="#E31937" font-weight="bold">1</text>
                        <text x="80" y="20" font-size="12" fill="#ccc">000</text>
                        <line x1="70" y1="25" x2="80" y2="25" stroke-dasharray="2 2"/>
                        <text x="10" y="45" font-size="12" fill="#ccc">lowbit(x) = 0000</text>
                        <text x="100" y="45" font-size="12" fill="#E31937" font-weight="bold">1</text>
                        <text x="110" y="45" font-size="12" fill="#ccc">000</text>
                    </svg>
                </div>
            </motion.div>

            <motion.div class="bento-item"
                :initial="{ opacity: 0, y: 60 }"
                :while-in-view="{ opacity: 1, y: 0 }"
                :viewport="{ once: true, amount: 0.3 }"
                :transition="{ duration: 0.6, delay: 0.3, ease: 'easeOut' }"
            >
                <h3 class="font-chinese-title text-2xl mb-3"><span class="font-code highlight">n & (n-1)</span></h3>
                <p class="font-english-accent mb-4">ERASING THE LOWEST SET BIT</p>
                <p class="text-sm mb-3">
                    此操作精准<span class="highlight">移除</span> `n` 中最右侧的 `1`。
                    <br>
                    核心应用：高效计算汉明权重 (Popcount)。
                </p>
                <p class="font-code text-base">n = 01011000 (88)</p>
                <p class="font-code text-base mt-1">n & (n-1) <span class="text-tesla-red mx-2 transform scale-150 inline-block">→</span> 01010000 (80)</p>
            </motion.div>

            <motion.div class="bento-item"
                :initial="{ opacity: 0, y: 60 }"
                :while-in-view="{ opacity: 1, y: 0 }"
                :viewport="{ once: true, amount: 0.3 }"
                :transition="{ duration: 0.6, delay: 0.4, ease: 'easeOut' }"
            >
                <h3 class="font-chinese-title text-2xl mb-3">汉明<span class="highlight">计数</span></h3>
                <p class="font-english-accent mb-4">HAMMING WEIGHT / POPCOUNT</p>
                <p class="text-sm mb-3">
                    统计二进制中 <span class="highlight">`1` 的数量</span>。
                </p>
                <p class="text-sm text-gray-200">策略:</p>
                <ul class="list-disc list-inside text-sm text-gray-300 space-y-1.5 mt-2">
                    <li>循环检查与右移。</li>
                    <li>迭代 <span class="font-code text-tesla-red text-xs">x &= (x-1)</span>。</li>
                    <li>迭代 <span class="font-code text-tesla-red text-xs">x -= lowbit(x)</span>。</li>
                </ul>
                <div class="large-digit-overlay" style="font-size: 5rem; bottom: 0.5rem; opacity:0.07; right: 1rem">1011</div>
            </motion.div>

            <motion.div class="bento-item md:grid-col-span-2"
                :initial="{ opacity: 0, y: 60 }"
                :while-in-view="{ opacity: 1, y: 0 }"
                :viewport="{ once: true, amount: 0.3 }"
                :transition="{ duration: 0.6, delay: 0.2, ease: 'easeOut' }"
            >
                <h3 class="font-chinese-title text-2xl mb-3">定点<span class="highlight">操控</span></h3>
                <p class="font-english-accent mb-4">TARGETED BIT MANIPULATION (0-indexed)</p>
                 <p class="text-sm mb-4">将整数W位视为布尔旗帜数组。</p>
                <div class="space-y-3">
                    <p class="text-sm"><strong class="text-tesla-red">置第k位为1:</strong> <span class="font-code">x | (1 << k)</span></p>
                    <p class="text-sm"><strong class="text-tesla-red">置第k位为0:</strong> <span class="font-code">x & (~(1 << k))</span></p>
                    <p class="text-sm"><strong class="text-tesla-red">翻转第k位:</strong> <span class="font-code">x ^ (1 << k)</span></p>
                    <p class="text-sm"><strong class="text-tesla-red">取第k位值:</strong> <span class="font-code">(x >> k) & 1</span></p>
                </div>
                <div class="line-art-container mt-5">
                     <svg viewBox="0 0 250 60" class="line-art-svg w-full h-auto max-h-20">
                        <text x="5" y="15" font-size="11" fill="#aaa">x = ...0101 (k=2, bit is 1)</text>
                        <rect x="70" y="5" width="12" height="12" fill="none" stroke-width="1.5"/>
                        <rect x="90" y="5" width="12" height="12" fill="rgba(227,25,55,0.3)" stroke-width="1.5"/>
                        <rect x="110" y="5" width="12" height="12" fill="none" stroke-width="1.5"/>
                        <rect x="130" y="5" width="12" height="12" fill="rgba(227,25,55,0.3)" stroke-width="1.5"/>
                        <text x="5" y="38" font-size="11" fill="#aaa">$1 \ll k$ (for k=2) is $...0100$</text>
                        <text x="5" y="58" font-size="11" fill="#aaa">$x \text{ | } (1 \ll k)$ (set k-th bit): $...0101 \text{ (no change if already 1)}$</text>
                    </svg>
                </div>
            </motion.div>

            <motion.div class="bento-item md:grid-col-span-3 lg:grid-col-span-2 decorative-glow"
                :initial="{ opacity: 0, scale: 0.95 }"
                :while-in-view="{ opacity: 1, scale: 1 }"
                :viewport="{ once: true, amount: 0.3 }"
                :transition="{ duration: 0.7, delay: 0.1, ease: 'easeOut' }"
            >
                <div class="flex items-center mb-5">
                    <i class="fab fa-dev text-tesla-red text-5xl mr-5"></i> <div>
                        <h2 class="font-chinese-title text-3xl">GCC 内建<span class="highlight">加速</span></h2>
                        <p class="font-english-accent">GCC BUILT-IN ACCELERATORS</p>
                    </div>
                </div>
                <p class="text-sm mb-5">
                    GCC编译器提供了一系列高效的内建函数，这些函数通常直接编译成单条或极少条的处理器指令，实现<span class="highlight">硬件级加速</span>。
                    <span class="font-english-accent block mt-1.5">These functions often map to single or few processor instructions for hardware-level speed.</span>
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-3 text-sm">
                    <p><span class="font-code text-tesla-red">__builtin_ffs(x)</span>: x末位1的位置 (1-idx), x=0 ⇒ 0。</p>
                    <p><span class="font-code text-tesla-red">__builtin_clz(x)</span>: 前导0数量。</p>
                    <p><span class="font-code text-tesla-red">__builtin_ctz(x)</span>: 末尾0数量。</p>
                    <p><span class="font-code text-tesla-red">__builtin_popcount(x)</span>: 统计置位1数量。</p>
                </div>
                <p class="text-xs text-gray-500 mt-4">提示: `clz`/`ctz` 对0行为未定义。亦有 `long` (`l`) 及 `long long` (`ll`) 版本，如 `__builtin_popcountll`。</p>
            </motion.div>

            <motion.div class="bento-item lg:grid-col-span-3"
                :initial="{ opacity: 0, y: 60 }"
                :while-in-view="{ opacity: 1, y: 0 }"
                :viewport="{ once: true, amount: 0.3 }"
                :transition="{ duration: 0.6, delay: 0.3, ease: 'easeOut' }"
            >
                <h3 class="font-chinese-title text-2xl mb-3">等重汉明<span class="highlight">后继</span></h3>
                <p class="font-english-accent mb-4">SUCCESSOR WITH EQUAL HAMMING WEIGHT</p>
                <p class="text-sm mb-3">
                    寻找给定数 `x` 在字典序上的下一个、且汉明权重（1的个数）相同的整数。
                    <br>This is invaluable for enumerating combinations or permutations with a fixed number of set bits.
                </p>
                <p class="text-sm mb-2">核心思路 (Conceptual):</p>
                <ol class="list-decimal list-inside text-sm text-gray-300 space-y-1.5 mb-4">
                    <li>定位最右非拖尾 `1` (rightmost non-trailing `1`). 设其位置为 $p_1$.</li>
                    <li>将此 `1` 左移一位 (effectively adding $2^{p_1}$ to a part of $x$). This is related to `x + lowbit_of_rightmost_block`.</li>
                    <li>将原 $p_1$ 右侧的所有 `1` 重新排列至最低位。</li>
                </ol>
                 <p class="text-sm mb-2 font-semibold text-gray-100">高效实现 (Optimized Formula):</p>
                <p class="font-code text-base mb-1.5"><span class="text-tesla-red">int</span> t = x + (x & -x); <span class="text-gray-500">// Add lowbit(x) to x</span></p>
                <p class="font-code text-base mb-3"><span class="text-tesla-red">int</span> next_x = t | ((((t & -t) / (x & -x)) >> 1) - 1);</p>
                <p class="text-xs text-gray-500">适用条件: `x` 非全1序列或0。</p>
                <p class="font-code text-base mt-2">示例: x = <span class="text-tesla-red">0110</span> (6, HW=2) <span class="text-tesla-red mx-2 transform scale-150 inline-block">→</span> next = <span class="text-tesla-red">1001</span> (9, HW=2)</p>
            </motion.div>

        </div>

        <footer class="text-center py-16 mt-12 border-t border-gray-800">
            <p class="font-english-accent text-base mb-2">Content derived from OI Wiki & Bitwise Operation Principles</p>
            <p class="text-sm text-gray-400">Designed with Bento Grid & Tesla-inspired Aesthetics</p>
            <p class="text-xs text-gray-600 mt-4">Current Date: <span id="currentDate"></span> (Client-side)</p>
        </footer>
    </div>

    <script>
        const { motion } = Motion;

        document.addEventListener('DOMContentLoaded', () => {
            // KaTeX auto-render
            renderMathInElement(document.body, {
                delimiters: [
                    {left: "$$", right: "$$", display: true},
                    {left: "$", right: "$", display: false},
                    {left: "\\(", right: "\\)", display: false},
                    {left: "\\[", right: "\\]", display: true}
                ],
                throwOnError: false
            });

            // Update date
            const dateElement = document.getElementById('currentDate');
            if (dateElement) {
                const today = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                dateElement.textContent = today.toLocaleDateString(undefined, options);
            }

            // Framer Motion animations
            const motionElements = document.querySelectorAll('header h1, header p, .bento-item');

            motionElements.forEach((element, index) => {
                let initial = { opacity: 0, y: 60 }; // Default for bento items
                let whileInView = { opacity: 1, y: 0 };
                let transition = { duration: 0.6, ease: [0.25, 0.1, 0.25, 1] }; // Default cubic-bezier
                let viewport = { once: true, amount: 0.2 }; // Trigger a bit earlier

                const baseDelay = 0.1;

                if (element.tagName.toLowerCase() === 'h1') {
                    initial = { opacity: 0, y: -60 };
                    transition.duration = 0.9;
                    transition.ease = [0.16, 1, 0.3, 1]; // EaseOutExpo
                } else if (element.tagName.toLowerCase() === 'p' && element.parentElement.tagName.toLowerCase() === 'header') {
                    initial = { opacity: 0, y: -40 };
                    transition.duration = 0.9;
                    transition.delay = 0.15;
                     transition.ease = [0.16, 1, 0.3, 1];
                } else if (element.classList.contains('bento-item')) {
                    // Stagger bento items slightly
                    transition.delay = baseDelay + (index - 2) * 0.075; // -2 to offset header elements
                    if (element.innerHTML.includes("二进制原力") || element.innerHTML.includes("GCC 内建加速")) {
                         initial = { opacity: 0, scale: 0.9 };
                         whileInView = { opacity: 1, scale: 1 };
                         transition.duration = 0.7;
                    }
                }

                // Ensure delay is not negative
                if (transition.delay < 0) transition.delay = 0;


                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            motion.animate(entry.target, whileInView, transition);
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: viewport.amount });

                motion.set(element, initial);
                observer.observe(element);
            });
        });
    </script>
</body>
</html>